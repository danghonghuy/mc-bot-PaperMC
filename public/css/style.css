@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@500;700;900&family=Exo+2:wght@700;800&display=swap');

@property --angle { syntax: '<angle>'; initial-value: 0deg; inherits: false; }
@property --hueRotate { syntax: '<angle>'; initial-value: 0deg; inherits: false; }
@property --glowOpacity { syntax: '<number>'; initial-value: 0.5; inherits: false; }
@property --sparkleX { syntax: '<length-percentage>'; initial-value: -100%; inherits: false; }
@property --borderGradientPos { syntax: '<percentage>'; initial-value: 0%; inherits: false; }

:root {
  --hue-primary: 220;
  --hue-secondary: 290;
  --hue-tertiary: 170;
  --hue-quaternary: 30;
  --hue-quinary: 0;
  --hue-senary: 130;

  --hue-danger: var(--hue-quinary);
  --hue-success: var(--hue-senary);
  --hue-warning: var(--hue-quaternary);
  --hue-info: var(--hue-primary);
  --hue-magic: var(--hue-secondary);
  --hue-tech: var(--hue-tertiary);
  --hue-gold: var(--hue-quaternary);
  --hue-gray: 230;

  --saturation-high: 100%;
  --saturation-mid: 90%;
  --saturation-low: 75%;
  --lightness-max: 98%;
  --lightness-high: 95%;
  --lightness-mid: 70%;
  --lightness-low: 50%;
  --lightness-min: 3%;
  --lightness-surface-1: 6%;
  --lightness-surface-2: 11%;
  --lightness-surface-3: 17%;
  --lightness-border: 30%;

  --primary-main: hsl(var(--hue-primary), var(--saturation-mid), var(--lightness-mid));
  --primary-light: hsl(var(--hue-primary), var(--saturation-mid), calc(var(--lightness-mid) + 15%));
  --primary-dark: hsl(var(--hue-primary), var(--saturation-mid), calc(var(--lightness-mid) - 15%));
  --primary-glow-color: hsla(var(--hue-primary), var(--saturation-high), calc(var(--lightness-mid) + 10%), 0.7);

  --secondary-main: hsl(var(--hue-secondary), var(--saturation-high), var(--lightness-mid));
  --secondary-light: hsl(var(--hue-secondary), var(--saturation-high), calc(var(--lightness-mid) + 15%));
  --secondary-dark: hsl(var(--hue-secondary), var(--saturation-high), calc(var(--lightness-mid) - 15%));
  --secondary-glow-color: hsla(var(--hue-secondary), var(--saturation-high), calc(var(--lightness-mid) + 10%), 0.75);

  --tertiary-main: hsl(var(--hue-tertiary), var(--saturation-mid), var(--lightness-mid));
  --tertiary-light: hsl(var(--hue-tertiary), var(--saturation-mid), calc(var(--lightness-mid) + 15%));
  --tertiary-dark: hsl(var(--hue-tertiary), var(--saturation-mid), calc(var(--lightness-mid) - 15%));
  --tertiary-glow-color: hsla(var(--hue-tertiary), var(--saturation-high), calc(var(--lightness-mid) + 5%), 0.7);

  --quaternary-main: hsl(var(--hue-quaternary), var(--saturation-high), var(--lightness-mid));
  --quaternary-light: hsl(var(--hue-quaternary), var(--saturation-high), calc(var(--lightness-mid) + 10%));
  --quaternary-dark: hsl(var(--hue-quaternary), var(--saturation-high), calc(var(--lightness-mid) - 18%));
  --quaternary-glow-color: hsla(var(--hue-quaternary), var(--saturation-high), var(--lightness-mid), 0.7);

  --danger-main: hsl(var(--hue-danger), var(--saturation-high), var(--lightness-mid));
  --danger-light: hsl(var(--hue-danger), var(--saturation-high), calc(var(--lightness-mid) + 12%));
  --danger-dark: hsl(var(--hue-danger), var(--saturation-high), calc(var(--lightness-mid) - 15%));
  --danger-glow-color: hsla(var(--hue-danger), var(--saturation-high), calc(var(--lightness-mid) + 5%), 0.75);

  --success-main: hsl(var(--hue-success), var(--saturation-mid), calc(var(--lightness-mid) - 5%));
  --success-light: hsl(var(--hue-success), var(--saturation-mid), var(--lightness-mid));
  --success-dark: hsl(var(--hue-success), var(--saturation-mid), calc(var(--lightness-mid) - 20%));
  --success-glow-color: hsla(var(--hue-success), var(--saturation-high), var(--lightness-mid), 0.7);

  --info-main: var(--primary-main);
  --info-light: var(--primary-light);
  --info-dark: var(--primary-dark);
  --info-glow-color: var(--primary-glow-color);

  --bg-base: hsl(var(--hue-gray), 15%, var(--lightness-min));
  --bg-surface-1: hsl(var(--hue-gray), 18%, var(--lightness-surface-1));
  --bg-surface-2: hsl(var(--hue-gray), 20%, var(--lightness-surface-2));
  --bg-surface-3: hsl(var(--hue-gray), 22%, var(--lightness-surface-3));

  --text-primary: hsl(var(--hue-gray), 10%, var(--lightness-high));
  --text-secondary: hsl(var(--hue-gray), 12%, calc(var(--lightness-high) - 18%));
  --text-tertiary: hsl(var(--hue-gray), 15%, calc(var(--lightness-high) - 35%));
  --text-white: hsl(0, 0%, var(--lightness-max));
  --text-glow: 0 0 6px hsla(0, 0%, var(--lightness-high), 0.6);

  --border-base: hsl(var(--hue-gray), 25%, var(--lightness-border));
  --border-light: hsl(var(--hue-gray), 28%, calc(var(--lightness-border) + 15%));
  --border-focus: var(--secondary-light);
  --border-magic: transparent;

  --bot-message-text: var(--tertiary-main);
  --system-message-text: var(--quaternary-light);
  --error-message-text: var(--danger-light);
  --health-color: var(--danger-main);
  --food-color: var(--quaternary-main);
  --position-color: var(--primary-light);

  --shadow-color-base: hsla(var(--hue-gray), 50%, 2%, 0.75);
  --shadow-sm: 0 4px 8px var(--shadow-color-base);
  --shadow: 0 8px 16px var(--shadow-color-base);
  --shadow-md: 0 12px 30px -4px var(--shadow-color-base);
  --shadow-lg: 0 20px 50px -10px var(--shadow-color-base);
  --shadow-xl: 0 35px 80px -20px var(--shadow-color-base);
  --shadow-inset: inset 0 2px 8px 1px hsla(0, 0%, 0%, 0.5);
  --shadow-inset-light: inset 0 1px 2px hsla(0, 0%, var(--lightness-high), 0.1);

  --glow-sm: 0 0 10px 1px;
  --glow-md: 0 0 20px 3px;
  --glow-lg: 0 0 35px 6px;
  --glow-xl: 0 0 50px 10px;

  --shadow-glow-primary: var(--glow-md) var(--primary-glow-color);
  --shadow-glow-secondary: var(--glow-lg) var(--secondary-glow-color);
  --shadow-glow-tertiary: var(--glow-md) var(--tertiary-glow-color);
  --shadow-glow-quaternary: var(--glow-md) var(--quaternary-glow-color);
  --shadow-glow-danger: var(--glow-lg) var(--danger-glow-color);
  --shadow-glow-success: var(--glow-md) var(--success-glow-color);
  --shadow-glow-info: var(--glow-md) var(--info-glow-color);
  --shadow-glow-white: var(--glow-sm) hsla(0, 0%, var(--lightness-max), 0.6);
  --shadow-glow-multi:
      var(--glow-sm) var(--primary-glow-color),
      var(--glow-sm) var(--secondary-glow-color),
      var(--glow-sm) var(--tertiary-glow-color);
  --shadow-focus-ring: 0 0 0 4px hsla(var(--hue-secondary), var(--saturation-high), var(--lightness-mid), 0.5);

  --timing-snap: cubic-bezier(0, 1, 0, 1);
  --timing-ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --timing-ease-out-cubic: cubic-bezier(0.215, 0.61, 0.355, 1);
  --timing-ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1);
  --timing-ease-out-quint: cubic-bezier(0.23, 1, 0.32, 1);
  --timing-ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
  --timing-ease-in-out-sine: cubic-bezier(0.445, 0.05, 0.55, 0.95);
  --timing-ease-in-out-cubic: cubic-bezier(0.645, 0.045, 0.355, 1);
  --timing-elastic-out: cubic-bezier(0.68, -0.6, 0.32, 1.6);
  --timing-back-out: cubic-bezier(0.34, 1.56, 0.64, 1);

  --transition-fast: all 250ms var(--timing-ease-out-cubic);
  --transition: all 450ms var(--timing-ease-in-out-cubic);
  --transition-slow: all 800ms var(--timing-ease-in-out-sine);
  --transition-hyper: all 600ms var(--timing-ease-out-expo);
  --transition-elastic: all 550ms var(--timing-elastic-out);
  --transition-transform: transform 450ms var(--timing-ease-in-out-cubic);
  --transition-glow: box-shadow 500ms var(--timing-ease-out-cubic);
  --transition-color: color 350ms var(--timing-ease-out-quad), background-color 350ms var(--timing-ease-out-quad), border-color 350ms var(--timing-ease-out-quad);

  --radius-sm: 6px;
  --radius: 12px;
  --radius-md: 18px;
  --radius-lg: 25px;
  --radius-xl: 35px;
  --radius-full: 50%;

  --space-base-unit: 0.6rem;
  --space-xxs: calc(var(--space-base-unit) * 0.5);
  --space-xs: var(--space-base-unit);
  --space-sm: calc(var(--space-base-unit) * 1.5);
  --space-md: calc(var(--space-base-unit) * 2.2);
  --space-lg: calc(var(--space-base-unit) * 3.3);
  --space-xl: calc(var(--space-base-unit) * 5);
  --space-xxl: calc(var(--space-base-unit) * 8);

  --font-sans: 'Inter', sans-serif;
  --font-mono: 'Fira Code', monospace;
  --font-display: 'Orbitron', sans-serif;
  --font-tech: 'Exo 2', sans-serif;

  --font-size-xs:   clamp(0.8rem,   0.1vw + 0.78rem, 0.85rem);
  --font-size-sm:   clamp(0.9rem,   0.15vw + 0.87rem, 1.0rem);
  --font-size-base: clamp(1.0rem,   0.2vw + 0.96rem, 1.15rem);
  --font-size-md:   clamp(1.15rem,  0.25vw + 1.1rem, 1.35rem);
  --font-size-lg:   clamp(1.35rem,  0.4vw + 1.27rem, 1.7rem);
  --font-size-xl:   clamp(1.8rem,   0.8vw + 1.64rem, 2.3rem);
  --font-size-xxl:  clamp(2.5rem,   1.5vw + 2.2rem, 3.5rem);

  --font-weight-light: 300;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --font-weight-black: 800;

  --line-height-tight: 1.3;
  --line-height-normal: 1.7;
  --line-height-loose: 2.0;

  --glass-bg: hsla(var(--hue-gray), 35%, var(--lightness-surface-1), 0.65);
  --glass-border-color: hsla(var(--hue-primary), 40%, var(--lightness-high), 0.15);
  --glass-shadow: 0 20px 55px 10px hsla(var(--hue-gray), 45%, 3%, 0.65);
  --glass-blur: blur(20px);
  --glass-saturation: saturate(150%);
  --glass-brightness: brightness(1.1);

  --aurora-angle: 165deg;
  --aurora-speed: 20s;
  --aurora-blur: 100px;
  --aurora-opacity: 0.28;
  --aurora-mix: overlay;
  --aurora-color-1: hsla(var(--hue-primary),    95%, 60%, var(--aurora-opacity));
  --aurora-color-2: hsla(var(--hue-secondary),  100%, 65%, var(--aurora-opacity));
  --aurora-color-3: hsla(var(--hue-tertiary),   90%, 55%, var(--aurora-opacity));
  --aurora-color-4: hsla(var(--hue-quaternary), 100%, 60%, var(--aurora-opacity));
  --aurora-color-5: hsla(var(--hue-quinary),    95%, 60%, var(--aurora-opacity));
  --aurora-color-6: hsla(var(--hue-senary),     90%, 55%, var(--aurora-opacity));

  --noise-opacity: 0.035;
  --grid-opacity: 0.05;
  --grid-color: hsla(var(--hue-tertiary), 70%, 70%, var(--grid-opacity));
  --grid-size: 45px;
  --scanline-opacity: 0.04;
  --scanline-color: hsla(0, 0%, 0%, var(--scanline-opacity));
}

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  border: 0 solid var(--border-magic);
  will-change: opacity, transform, filter, box-shadow;
}
html {
  font-size: 16px;
  scroll-behavior: smooth;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: var(--font-sans);
  font-size: var(--font-size-base);
  background-color: var(--bg-base);
  color: var(--text-primary);
  line-height: var(--line-height-normal);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
  min-height: 100vh;
  position: relative;
  isolation: isolate;
}

#background-layers {
  position: fixed;
  inset: 0;
  z-index: -5;
  overflow: hidden;
}

#aurora-layer {
  position: absolute;
  inset: -100%;
  background-image: linear-gradient(var(--aurora-angle),
      var(--aurora-color-1), var(--aurora-color-2), var(--aurora-color-3),
      var(--aurora-color-4), var(--aurora-color-5), var(--aurora-color-6),
      var(--aurora-color-1) );
  background-size: 600% 600%;
  animation: moveAuroraHyper var(--aurora-speed) linear infinite;
  filter: blur(var(--aurora-blur)) brightness(1.15) saturate(1.5);
  opacity: 1;
  mix-blend-mode: var(--aurora-mix);
}

#nebula-layer {
  position: absolute;
  inset: -50%;
  background:
    radial-gradient(ellipse at 20% 30%, hsla(var(--hue-primary), 70%, 40%, 0.35) 0%, transparent 55%),
    radial-gradient(ellipse at 80% 70%, hsla(var(--hue-secondary), 75%, 45%, 0.40) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, hsla(var(--hue-tertiary), 70%, 35%, 0.30) 0%, transparent 65%);
  animation: subtleNebulaWarp 25s ease-in-out infinite alternate;
  mix-blend-mode: screen;
}

#overlay-layers {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  mix-blend-mode: overlay;
}
#noise-overlay {
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.3' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  opacity: var(--noise-opacity);
  animation: noiseFlicker 0.15s infinite alternate;
}
#grid-overlay {
  position: absolute;
  inset: 0;
  background-image:
    linear-gradient(var(--grid-color) 1px, transparent 1px),
    linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
  background-size: var(--grid-size) var(--grid-size);
  animation: moveGridSteady 30s linear infinite;
  opacity: var(--grid-opacity);
}
#scanline-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(0deg, transparent 50%, var(--scanline-color) 50%);
  background-size: 100% 4px;
  opacity: 1;
  animation: moveScanlines 0.1s linear infinite;
}

::-webkit-scrollbar {
  width: 14px;
  height: 14px;
}
::-webkit-scrollbar-track {
  background: hsla(var(--hue-gray), 20%, 10%, 0.6);
  border-radius: 10px;
}
::-webkit-scrollbar-thumb {
  background: linear-gradient(170deg, var(--secondary-main), var(--tertiary-main), var(--primary-main));
  border-radius: var(--radius-full);
  border: 3px solid transparent;
  background-clip: padding-box;
  box-shadow: inset 0 0 6px hsla(0, 0%, 0%, 0.7), var(--glow-sm) var(--secondary-glow-color);
  transition: background 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease;
  animation: scrollbarHueShift 8s linear infinite;
}
::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(170deg, var(--secondary-light), var(--tertiary-light), var(--primary-light));
  box-shadow: inset 0 0 8px hsla(0, 0%, 0%, 0.5), var(--glow-md) var(--secondary-glow-color);
  animation-play-state: running;
}
::-webkit-scrollbar-corner {
  background: transparent;
}

#app-container {
  display: flex;
  min-height: 100vh;
  position: relative;
}

#sidebar {
  width: clamp(330px, 24vw, 420px);
  flex-shrink: 0;
  background: var(--glass-bg);
  backdrop-filter: var(--glass-blur) var(--glass-saturation) var(--glass-brightness);
  -webkit-backdrop-filter: var(--glass-blur) var(--glass-saturation) var(--glass-brightness);
  padding: var(--space-lg) var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-xl);
  z-index: 10;
  position: relative;
  border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
  border: 1px solid var(--glass-border-color);
  box-shadow: var(--glass-shadow);
  transform: translateX(-100%) scale(0.95);
  opacity: 0;
  transform-origin: left center;
  animation: sidebarEntrance 1.2s var(--timing-back-out) 0.5s forwards;
}

#sidebar::before {
  content: '';
  position: absolute;
  inset: -3px;
  border-radius: inherit;
  padding: 3px;
  z-index: -1;
  background: conic-gradient(from var(--angle),
      hsl(calc(var(--hueRotate) + 0),   100%, 70%), hsl(calc(var(--hueRotate) + 60),  100%, 70%),
      hsl(calc(var(--hueRotate) + 120), 100%, 70%), hsl(calc(var(--hueRotate) + 180), 100%, 70%),
      hsl(calc(var(--hueRotate) + 240), 100%, 70%), hsl(calc(var(--hueRotate) + 300), 100%, 70%),
      hsl(calc(var(--hueRotate) + 360), 100%, 70%) );
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  animation: sidebarBorderSpin 4s linear infinite;
  transition: opacity 0.5s ease, filter 0.5s ease;
  opacity: var(--glowOpacity);
  filter: brightness(1.2) saturate(1.5);
}

#sidebar:hover::before {
  animation-duration: 2s;
  --glowOpacity: 1;
  filter: brightness(1.6) saturate(1.9);
}

.sidebar-header {
  padding-bottom: var(--space-md);
  text-align: center;
  margin-top: var(--space-sm);
  position: relative;
}
.sidebar-header::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 10%;
  right: 10%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--secondary-light) 40%, var(--tertiary-light) 60%, transparent);
  filter: blur(2.5px);
  opacity: 0.9;
  transform: scaleX(0.8);
  transition: transform 0.5s var(--timing-back-out), opacity 0.5s ease, filter 0.5s ease;
}
#sidebar:hover .sidebar-header::after {
  transform: scaleX(1.1);
  opacity: 1;
  filter: blur(1.5px);
}

.sidebar-header h1 {
  font-family: var(--font-tech);
  font-size: var(--font-size-xl);
  font-weight: 700;
  margin-bottom: var(--space-md);
  color: var(--text-white);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  text-shadow: 0 0 12px var(--secondary-glow-color), 0 0 25px var(--tertiary-glow-color), 0 0 5px var(--text-white);
  transform: scale(1.0);
  transition: transform 0.5s var(--timing-back-out), text-shadow 0.5s ease;
}
#sidebar:hover .sidebar-header h1 {
  transform: scale(1.03);
  text-shadow: 0 0 15px var(--secondary-glow-color), 0 0 30px var(--tertiary-glow-color), 0 0 8px var(--text-white);
}

.sidebar-header h1 i {
  color: var(--secondary-light);
  font-size: 1.2em;
  margin-bottom: -4px;
  filter: drop-shadow(0 0 15px var(--secondary-light)) drop-shadow(0 0 5px var(--tertiary-light));
  filter: drop-shadow(0 0 2px var(--secondary-main));
  animation: iconPulseAndFloat 4s ease-in-out infinite;
}

#connection-status {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  padding: var(--space-xs) 0;
}
#status-text {
  text-shadow: var(--text-glow);
}
#connection-status .fa-circle {
  font-size: 0.85em;
  width: 1.9em;
  height: 1.9em;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s var(--timing-ease-out-cubic);
  position: relative;
  animation: statusDotPulse 1.8s infinite;
  color: hsla(0,0%,0%,0.5);
}
#connection-status .fa-circle::before {
  content:'';
  position: absolute;
  inset: 3px;
  border-radius: 50%;
  background: radial-gradient(circle, hsla(0,0%,100%,0.6), hsla(0,0%,100%,0) 65%);
  opacity: 0.8;
  transition: opacity 0.4s ease;
}
#connection-status .fa-circle::after {
  content: '';
  position: absolute;
  inset: -6px;
  border-radius: 50%;
  border: 2px solid currentColor;
  opacity: 0;
  animation: statusRingExpand 1.8s infinite var(--timing-ease-out-cubic);
  transform-origin: center;
}
.status-connected { color: var(--success-main); }
.status-disconnected { color: var(--danger-main); }
.status-waiting { color: var(--warning-main); }

.status-connected .fa-circle { background-color: var(--success-light); box-shadow: var(--shadow-glow-success), var(--shadow-inset-light); }
.status-disconnected .fa-circle { background-color: var(--danger-light); box-shadow: var(--shadow-glow-danger), var(--shadow-inset-light); animation-delay: -0.6s; }
.status-waiting .fa-circle { background-color: var(--quaternary-light); box-shadow: var(--shadow-glow-quaternary), var(--shadow-inset-light); animation-delay: -1.2s; }
#connection-status .fa-circle:hover::before { opacity: 1; }

.sidebar-sections {
  display: flex;
  flex-direction: column;
  gap: var(--space-lg);
  flex-grow: 1;
  overflow-y: auto;
  overflow-x:hidden;
  padding: 5px var(--space-xs) var(--space-lg) 5px;
  margin-right: calc(-1 * var(--space-xs));
}
section {
  background: hsla(var(--hue-gray), 24%, var(--lightness-surface-2), 0.8);
  border-radius: var(--radius-lg);
  padding: var(--space-lg) var(--space-lg);
  border: 1px solid var(--border-base);
  transition: all 0.5s var(--timing-back-out);
  position: relative;
  overflow: hidden;
  opacity: 0;
  transform: perspective(800px) rotateX(-15deg) translateY(40px) scale(0.95);
  animation: sectionEntrance 0.9s var(--timing-back-out) forwards;
  box-shadow: var(--shadow-md);
}
.sidebar-sections section:nth-child(1) { animation-delay: 0.7s; }
.sidebar-sections section:nth-child(2) { animation-delay: 0.8s; }
.sidebar-sections section:nth-child(3) { animation-delay: 0.9s; }

section:hover {
  transform: perspective(1000px) rotateX(0deg) translateY(-8px) scale(1.03);
  border-color: var(--secondary-light);
  box-shadow: var(--shadow-lg), var(--shadow-glow-secondary);
  background: hsla(var(--hue-gray), 26%, calc(var(--lightness-surface-2) + 4%), 0.9);
}

section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 6px;
  height: 100%;
  background: linear-gradient(180deg,
      var(--secondary-light) 0%, var(--tertiary-main) 50%, var(--primary-light) 100%);
  background-size: 100% 200%;
  animation: energyLineFlow 3s linear infinite;
  transform: scaleY(0);
  transform-origin: center;
  z-index: 1;
  transition: transform 0.6s var(--timing-elastic-out), box-shadow 0.6s ease, opacity 0.6s ease;
  box-shadow: 0 0 12px 2px var(--secondary-glow-color);
  opacity: 0;
  filter: brightness(1.1);
}
section:hover::before {
  transform: scaleY(1);
  opacity: 1;
  box-shadow: 0 0 25px 5px var(--secondary-glow-color);
}

section::after {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
      linear-gradient(hsla(var(--hue-tertiary), 60%, 70%, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, hsla(var(--hue-tertiary), 60%, 70%, 0.1) 1px, transparent 1px);
  background-size: 35px 35px;
  background-position: 0 0;
  opacity: 0;
  z-index: 0;
  transition: opacity 0.6s ease, background-position 0.6s ease;
  animation: dataGridPulse 10s linear infinite alternate;
  pointer-events: none;
  mix-blend-mode: color-dodge;
}
section:hover::after {
  opacity: 0.6;
  background-position: 10px 10px;
  animation-play-state: paused;
}

section h2 {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
  padding-bottom: var(--space-sm);
  font-family: var(--font-display);
  font-size: var(--font-size-lg);
  font-weight: 700;
  color: var(--text-white);
  position: relative;
  letter-spacing: 1px;
  text-transform: uppercase;
  text-shadow: var(--text-glow);
}

section h2::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 3px;
  border-radius: 2px;
  opacity: 0.7;
  background: linear-gradient(90deg,
    var(--secondary-main), var(--tertiary-light), var(--primary-main),
    var(--tertiary-light), var(--secondary-main));
  background-size: 300% 100%;
  animation: underlineShine 4s linear infinite;
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.7s var(--timing-back-out), opacity 0.5s ease, filter 0.5s ease;
  filter: blur(1px);
}
section:hover h2::after {
  transform: scaleX(1);
  opacity: 1;
  filter: blur(0);
}

section h2 i {
  color: var(--tertiary-main);
  font-size: 1.3em;
  filter: drop-shadow(0 0 10px var(--tertiary-main));
  transition: transform 0.6s var(--timing-elastic-out), color 0.4s ease, filter 0.4s ease;
}
section:hover h2 i {
  transform: scale(1.25) rotate(-12deg);
  color: var(--tertiary-light);
  filter: drop-shadow(0 0 18px var(--tertiary-light));
}

#main-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  padding: var(--space-xl) var(--space-xxl);
  background: transparent;
  overflow: auto;
  position: relative;
}

.status-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-md);
}
.status-item {
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  gap: var(--space-md);
  padding: var(--space-sm) var(--space-md);
  background: var(--bg-surface-3);
  border-radius: var(--radius);
  border: 1px solid var(--border-base);
  transition: all 0.4s var(--timing-ease-out-cubic);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}
.status-item:hover {
  border-color: var(--border-light);
  background: var(--bg-surface-2);
  transform: scale(1.03);
  box-shadow: var(--shadow);
}
.status-label {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--text-secondary);
  z-index: 2;
}
.status-label i {
  width: 32px;
  text-align: center;
  font-size: 1.4em;
  line-height: 1;
  transition: transform 0.5s var(--timing-elastic-out), color 0.4s ease, filter 0.4s ease;
}
.status-item:hover .status-label i {
  transform: scale(1.25) rotate(-8deg);
  filter: drop-shadow(0 0 10px currentColor);
}

.status-value {
  font-weight: var(--font-weight-bold);
  font-family: var(--font-mono);
  font-size: var(--font-size-md);
  justify-self: end;
  position: relative;
  z-index: 2;
  text-shadow: var(--text-glow), 0 0 10px currentColor;
  letter-spacing: 1px;
  transition: color 0.4s ease, text-shadow 0.4s ease;
  white-space: normal;
  padding-right: var(--space-xs);
}
#health + .status-value { color: var(--health-color); }
#food + .status-value { color: var(--food-color); }
#position + .status-value { color: var(--position-color); font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); text-align: right;}

.status-item:has(#health) .status-label i { color: var(--health-color); }
.status-item:has(#food) .status-label i { color: var(--food-color); }
.status-item:has(#position) .status-label i { color: var(--position-color); }

.status-item::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  grid-column: 1 / -1;
  width: calc(var(--status-percent, 0) * 1%);
  border-radius: 0 var(--radius) var(--radius) 0;
  transition: width 0.8s var(--timing-ease-out-expo), background 0.5s ease, filter 0.5s ease;
  z-index: 1;
  opacity: 0.75;
  mix-blend-mode: screen;
  filter: brightness(1.3) saturate(1.3);
}
.status-item:hover::after { filter: brightness(1.6) saturate(1.5); }
.status-item:has(#health)::after { background: linear-gradient(90deg, transparent 10%, hsla(var(--hue-danger), 90%, 60%, 0.85) 90%); }
.status-item:has(#food)::after { background: linear-gradient(90deg, transparent 10%, hsla(var(--hue-warning), 90%, 65%, 0.85) 90%); }
.status-item:has(#position)::after { display: none; }

.inventory-grid {
  display: grid;
  grid-template-columns: repeat(9, minmax(0, 1fr));
  gap: 10px;
  margin-bottom: var(--space-md);
  perspective: 1800px;
}
.inventory-item {
  position: relative;
  aspect-ratio: 1 / 1;
  background: transparent;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.5s var(--timing-elastic-out), box-shadow 0.5s var(--timing-ease-out-cubic);
  cursor: default;
  transform-style: preserve-3d;
  border: 1px solid hsla(var(--hue-tertiary), 60%, 60%, 0.25);
  transform: translateZ(0px);
}
.inventory-item::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  z-index: -1;
  background: radial-gradient(ellipse at center, hsla(var(--hue-tertiary), 70%, 70%, 0.12), transparent 70%),
              linear-gradient(0deg, hsla(var(--hue-tertiary), 50%, 50%, 0.07) 1px, transparent 1px),
              linear-gradient(90deg, hsla(var(--hue-tertiary), 50%, 50%, 0.07) 1px, transparent 1px);
  background-size: 100% 100%, 8px 8px, 8px 8px;
  box-shadow: inset 0 0 15px hsla(var(--hue-tertiary), 70%, 75%, 0.3), 0 0 0 1px hsla(var(--hue-tertiary), 60%, 60%, 0.25);
  transition: all 0.4s var(--timing-ease-out-cubic);
  opacity: 0.7;
  animation: invGridPulse 6s infinite alternate;
}
.inventory-item:hover {
  transform: translateZ(55px) rotateY(15deg) rotateX(5deg) scale(1.25);
  z-index: 5;
}
.inventory-item:hover::before {
  opacity: 1;
  background-size: 100% 100%, 6px 6px, 6px 6px;
  background-color: hsla(var(--hue-tertiary), 75%, 80%, 0.15);
  box-shadow: inset 0 0 30px hsla(var(--hue-tertiary), 75%, 80%, 0.45), 0 0 0 2px var(--tertiary-main), var(--shadow-glow-tertiary);
}
.inventory-item img {
  width: 75%;
  height: 75%;
  object-fit: contain;
  image-rendering: pixelated;
  position: relative;
  z-index: 1;
  filter: drop-shadow(0 5px 8px hsla(0, 0%, 0%, 0.5));
  transition: transform 0.5s var(--timing-back-out);
}
.inventory-item:hover img {
  transform: scale(1.2) rotateZ(8deg) translateY(-5px);
}

.item-count {
  position: absolute;
  bottom: 4px;
  right: 6px;
  z-index: 2;
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-black);
  font-family: var(--font-mono);
  background: linear-gradient(135deg, hsla(var(--hue-secondary), 90%, 50%, 0.95), hsla(var(--hue-secondary), 95%, 40%, 0.95));
  color: var(--text-white);
  padding: 2px 7px;
  border-radius: var(--radius-sm);
  line-height: 1.1;
  pointer-events: none;
  text-shadow: 1px 1px 2px hsla(0, 0%, 0%, 0.7);
  border: 1px solid hsla(var(--hue-secondary), 70%, 75%, 0.7);
  box-shadow: 0 1px 3px hsla(0, 0%, 0%, 0.5);
  transition: all 0.4s var(--timing-back-out);
}
.inventory-item:hover .item-count {
  background: linear-gradient(135deg, var(--secondary-light), var(--secondary-main));
  border-color: var(--secondary-light);
  transform: scale(1.2) translate(3px, -3px);
  box-shadow: 0 0 10px 2px var(--secondary-glow-color), 0 2px 5px hsla(0, 0%, 0%, 0.6);
}

.chat-section {
  display: flex;
  flex-direction: column;
  min-height: 900px;
  max-height: 40vh;
 
}
.chat-container {
  flex-grow: 1;
  overflow-y: auto;
  background: transparent;
  border-radius: var(--radius-sm);
  padding: var(--space-sm) var(--space-md);
  margin-bottom: var(--space-md);
  display: flex;
  flex-direction: column-reverse;
  gap: var(--space-sm);
  position: relative;
  border: 1px solid hsla(var(--hue-primary), 50%, 60%, 0.35);
  box-shadow: inset 0 0 25px hsla(var(--hue-primary), 40%, 25%, 0.45);
}
chat-container::before,
.chat-container::after {
  content: '';
  position: sticky;
  left: 0;
  width: 100%;
  height: 70px; /* << Chiều cao gốc */
  z-index: 2;
  pointer-events: none;
  transition: opacity var(--transition-fast);
  opacity: 0; /* << Ẩn mặc định, hiện khi có class */
}
.chat-container::before { /* Top fade */
  top: 0;
  background: linear-gradient(to bottom, var(--bg-surface-2) 60%, transparent);
}
.chat-container::after { /* Bottom fade */
  bottom: 0;
  background: linear-gradient(to top, var(--bg-surface-2) 60%, transparent);
}
.chat-container.is-scrollable-top::before { opacity: 1; }
.chat-container.is-scrollable-bottom::after { opacity: 1; }

.chat-message {
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius);
  word-wrap: break-word;
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
  position: relative;
  margin-bottom: var(--space-xs);
  border-left: 5px solid transparent;
  background: hsla(var(--hue-primary), 30%, 20%, 0.7);
  box-shadow: 0 4px 10px hsla(0, 0%, 0%, 0.45);
  animation: messageEntrance 0.7s var(--timing-ease-out-expo) forwards;
  opacity: 0;
  transition: background 0.4s ease, border-left-color 0.4s ease, transform 0.3s var(--timing-ease-out-cubic);
}
.chat-message:hover {
  background: hsla(var(--hue-primary), 35%, 25%, 0.85);
  transform: translateX(6px);
}

.bot-message {
  border-left-color: var(--bot-message-text);
  background: hsla(var(--hue-tertiary), 50%, 22%, 0.7);
}
.bot-message:hover {
  background: hsla(var(--hue-tertiary), 55%, 28%, 0.85);
  border-left-color: var(--tertiary-light);
}
.bot-message .chat-username {
  color: var(--tertiary-light);
  text-shadow: var(--glow-sm) var(--tertiary-glow-color);
}

.system-message {
  color: var(--system-message-text);
  border-left-color: var(--system-message-text);
  font-style: italic;
  background: hsla(var(--hue-warning), 60%, 20%, 0.75);
  font-size: var(--font-size-xs);
  opacity: 0.9;
}
.system-message:hover {
  background: hsla(var(--hue-warning), 65%, 25%, 0.9);
  border-left-color: var(--quaternary-light);
}
.system-message .chat-username { display: none; }

.error-message {
  color: var(--error-message-text);
  border-left-color: var(--error-message-text);
  font-weight: var(--font-weight-medium);
  background: hsla(var(--hue-danger), 65%, 24%, 0.8);
  animation: messageEntrance 0.7s var(--timing-ease-out-expo) forwards,
             errorShake 0.9s var(--timing-ease-in-out-cubic) 0.7s both,
             errorPulseBorder 2s infinite 0.7s ease-in-out;
  transform-origin: center;
}
.error-message:hover {
  background: hsla(var(--hue-danger), 70%, 30%, 0.9);
  border-left-color: var(--danger-light);
}

.chat-username {
  font-weight: var(--font-weight-bold);
  margin-right: var(--space-sm);
  color: var(--secondary-main);
  text-shadow: var(--glow-sm) var(--secondary-glow-color);
  display: inline-block;
}

.chat-form {
  display: flex;
  gap: var(--space-sm);
  margin-top: auto;
}
.chat-form input[type="text"] {
  flex-grow: 1;
  padding: var(--space-sm) var(--space-md);
  background: var(--bg-surface-1);
  border: 1px solid var(--border-base);
  color: var(--text-primary);
  border-radius: var(--radius);
  font-size: var(--font-size-base);
  transition: all 0.4s var(--timing-ease-out-cubic);
  box-shadow: var(--shadow-inset);
  font-family: var(--font-sans);
  max-width: calc(100% - 40px - var(--space-sm));
}
.chat-form input[type="text"]::placeholder {
  color: var(--text-tertiary);
  opacity: 0.7;
  transition: opacity 0.4s ease;
}
.chat-form input[type="text"]:focus::placeholder { opacity: 0.4; }
.chat-form input[type="text"]:focus, .chat-form input[type="text"]:focus-visible {
  outline: none;
  border-color: var(--border-focus);
  background: var(--bg-surface-2);
  box-shadow: var(--shadow-focus-ring), var(--shadow-inset), var(--shadow-glow-secondary);
}
.chat-form button {
  padding: 0;
  background: linear-gradient(140deg, var(--secondary-main), var(--primary-main));
  color: var(--text-white);
  border: none;
  border-radius: var(--radius-full);
  cursor: pointer;
  transition: all 0.3s var(--timing-back-out);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.6em;
  flex-shrink: 0;
  width: 58px;
  height: 58px;
  box-shadow: var(--shadow), var(--shadow-glow-secondary), var(--shadow-inset-light);
  position: relative;
  overflow: hidden;
  transform: scale(1);
}
.chat-form button:hover {
  background: linear-gradient(140deg, var(--secondary-light), var(--primary-light));
  transform: scale(1.15) translateY(-3px);
  box-shadow: var(--shadow-lg), var(--glow-lg) var(--secondary-glow-color), var(--shadow-inset-light);
}
.chat-form button:active {
  transform: scale(0.98) translateY(0);
  background: linear-gradient(140deg, var(--secondary-dark), var(--primary-dark));
  box-shadow: var(--shadow-inset);
  transition-duration: 150ms;
  transition-timing-function: var(--timing-ease-out-cubic);
}
.chat-form button i {
  transition: transform 0.4s var(--timing-elastic-out);
  filter: drop-shadow(1px 1px 2px hsla(0, 0%, 0%, 0.4));
}
.chat-form button:hover i {
  transform: rotate(-20deg) scale(1.1);
}
.chat-form button::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: var(--text-white);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  filter: blur(1px);
}
.chat-form button:active::after {
  animation: rippleExplode 0.6s var(--timing-ease-out-expo) forwards;
}


.viewer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-lg);
  flex-wrap: wrap;
  gap: var(--space-md);
}
.viewer-header h2 {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  font-family: var(--font-tech);
  font-weight: 700;
  font-size: var(--font-size-xl);
  flex-shrink: 0;
  color: var(--text-white);
  text-shadow: 0 0 15px var(--primary-glow-color), 0 0 30px var(--tertiary-glow-color), 0 0 6px var(--text-white);
  letter-spacing: 1.5px;
  text-transform: uppercase;
}
.viewer-header h2 i {
  color: var(--primary-light);
  font-size: 1.3em;
  margin-bottom: -4px;
  filter: drop-shadow(0 0 18px var(--primary-light)) drop-shadow(0 0 8px var(--tertiary-light));
  filter: drop-shadow(0 0 2px var(--secondary-main));
  animation: iconPulseAndFloat 5s ease-in-out infinite alternate;
}
.viewer-controls {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
  /* Nút bấm trong .viewer-controls đã được style chung ở phần button rồi */
}

/* Container với đầy đủ hiệu ứng V3 */
#viewer-container {
  position: relative; /* Bắt buộc */
  flex-grow: 1;
  background: #010102; /* Nền đen V3 */
  border-radius: var(--radius-lg); /* Bo góc V3 */
  overflow: hidden; /* Bắt buộc */
  min-height: clamp(50vh, 60vh, 70vh); /* Chiều cao V3 */
  box-shadow: var(--shadow-xl), inset 0 0 0 3px hsla(var(--hue-primary), 50%, 40%, 0.75); /* Đổ bóng V3 */
  transition: box-shadow 0.5s var(--timing-ease-out-cubic), transform 0.5s var(--timing-ease-out-cubic); /* Transition V3 */
  margin-bottom: var(--space-xl); /* Khoảng cách V3 */
  transform: scale(1); /* Có thể giữ lại scale nếu không gây lỗi */
  isolation: isolate; /* Giữ lại để tạo stacking context riêng, có thể giúp quản lý z-index tốt hơn */
}
#viewer-container:hover { /* Hiệu ứng hover V3 */
  transform: scale(1.005);
  box-shadow: var(--shadow-xl), inset 0 0 0 5px var(--primary-light), var(--glow-lg) var(--primary-glow-color);
}

/* Iframe - Quay lại logic ẨN ban đầu, HIỆN khi có class .loaded */
#viewer-iframe {
  display: block;
  width: 100%;
  height: 100%;
  border: none;
  position: absolute;
  top: 0;
  left: 0;
  /* >>> TRẠNG THÁI MẶC ĐỊNH: ẨN <<< */
  opacity: 0;
  visibility: hidden;
  /* Hiệu ứng xuất hiện mượt mà hơn */
  transition: opacity 0.8s var(--timing-ease-out-cubic) 0.1s; /* Thêm delay nhẹ */
  /* Không cần transition visibility nữa vì nó sẽ đổi khi opacity > 0 */
}
#viewer-iframe.loaded { /* JS thêm class này khi iframe onload */
  /* >>> TRẠNG THÁI KHI LOAD XONG: HIỆN <<< */
  opacity: 1;
  visibility: visible;
}

/* Status Overlay - Giao diện V3, KHÔNG Z-INDEX, ẩn khi có class .hidden */
#viewer-status {
  position: absolute;
  inset: 0;
  /* >>> KHÔNG CÓ z-index: 2; <<< */ /* Rất quan trọng! */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-lg);
  background: rgba(5, 5, 10, 0.85); /* Nền mờ V3 */
  color: var(--text-secondary);
  font-size: var(--font-size-base);
  pointer-events: none; /* Vẫn giữ để an toàn, dù không còn nằm trên cùng */
  opacity: 1; /* Hiện mặc định */
  visibility: visible; /* Hiện mặc định */
  backdrop-filter: blur(10px); /* Hiệu ứng blur V3 */
  /* Transition cho việc MỜ ĐI khi bị ẩn - Làm mượt hơn */
  transition: opacity 0.6s var(--timing-ease-out-cubic),
              visibility 0s linear 0.6s, /* Ẩn visibility sau khi opacity về 0 */
              backdrop-filter 0.6s var(--timing-ease-out-cubic);
}

/* Logic ẩn Status khi có class .hidden (do JS thêm vào) */
#viewer-status.hidden {
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
  backdrop-filter: blur(0px);
}

/* Icon loading giữ nguyên hiệu ứng V3 */
#viewer-status i {
  font-size: 3.5em;
  color: var(--primary-main);
  text-shadow: 0 0 25px var(--primary-glow-color);
  animation: viewerSpinner 2.5s linear infinite, viewerGlowPulse 2.5s ease-in-out infinite alternate;
}
.control-panel {
  background: transparent;
  border-radius: var(--radius-xl);
  padding: var(--space-xl);
  border: 1px solid var(--border-base);
  box-shadow: var(--shadow-lg), inset 0 0 25px hsla(var(--hue-gray), 25%, 5%, 0.5);
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(clamp(300px, 32vw, 420px), 1fr));
  gap: var(--space-xl);
  margin-top: var(--space-lg);
  position: relative;
  background: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0)),
              radial-gradient(circle at 10% 10%, hsla(var(--hue-primary), 30%, 15%, 0.35), transparent 50%),
              radial-gradient(circle at 90% 90%, hsla(var(--hue-secondary), 30%, 15%, 0.4), transparent 50%);
}
.control-panel > div {
  display: flex;
  flex-direction: column;
  gap: var(--space-lg);
  background: hsla(var(--hue-gray), 22%, var(--lightness-surface-1), 0.8);
  padding: var(--space-lg);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-base);
  transition: all 0.4s var(--timing-ease-out-cubic);
  position: relative;
  overflow: hidden;
  box-shadow: 0 6px 18px hsla(0, 0%, 0%, 0.3);
}
.control-panel > div:hover {
  background: hsla(var(--hue-gray), 24%, var(--lightness-surface-2), 0.9);
  border-color: var(--border-light);
  transform: translateY(-5px);
  box-shadow: 0 12px 30px hsla(0, 0%, 0%, 0.4);
}
.control-panel > div::after {
  content: '';
  position: absolute;
  inset: -50%;
  z-index: 0;
  pointer-events: none;
  background: radial-gradient(ellipse at center, hsla(var(--hue-secondary), 70%, 60%, 0.12) 0%, transparent 65%);
  opacity: 0;
  transform: scale(0.5);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
.control-panel > div:hover::after {
  opacity: 0.8;
  transform: scale(1);
}

.control-panel h3 {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  font-family: var(--font-tech);
  font-size: var(--font-size-md);
  font-weight: 700;
  color: var(--text-white);
  margin-bottom: var(--space-sm);
  padding-bottom: var(--space-sm);
  position: relative;
  z-index: 1;
  letter-spacing: 1px;
  text-transform: uppercase;
  text-shadow: var(--text-glow);
}
.control-panel h3::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  height: 3px;
  width: 100%;
  background: linear-gradient(90deg, var(--secondary-light), var(--tertiary-light), var(--primary-light), var(--tertiary-light), var(--secondary-light));
  background-size: 400% 100%;
  border-radius: 2px;
  animation: techUnderlineFlow 5s linear infinite;
  transform: scaleX(0.8);
  transform-origin: center;
  opacity: 0.8;
  transition: transform 0.5s ease, opacity 0.5s ease, filter 0.5s ease;
  filter: blur(1px);
}
.control-panel > div:hover h3::after {
  transform: scaleX(1);
  opacity: 1;
  filter: blur(0px);
}

.control-panel h3 i {
  color: var(--secondary-main);
  filter: drop-shadow(0 0 10px var(--secondary-main));
  transition: transform 0.6s var(--timing-elastic-out), color 0.4s ease, filter 0.4s ease;
}
.control-panel > div:hover h3 i {
  transform: scale(1.15) rotate(-8deg);
  color: var(--secondary-light);
  filter: drop-shadow(0 0 15px var(--secondary-light));
}

.control-btn, .action-btn, .macro-btn, .waypoint-btn, .movement-btn {
  --btn-hue-1: var(--hue-secondary);
  --btn-hue-2: var(--hue-primary);
  --btn-glow-color: var(--secondary-glow-color);
  --btn-icon-color: var(--secondary-main);
  --btn-icon-color-hover: var(--secondary-light);

  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-bold);
  text-align: center;
  white-space: nowrap;
  user-select: none;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  min-height: 46px;
  color: var(--text-primary);
  position: relative;
  overflow: hidden;
  z-index: 1;
  border: 1px solid transparent;
  transform: translateZ(0);
  transition: color 0.4s ease, transform 0.2s var(--timing-ease-out-cubic), box-shadow 0.4s ease;
  background: transparent;
}

.control-btn::before, .action-btn::before, .macro-btn::before, .waypoint-btn::before, .movement-btn::before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: -2;
  border-radius: inherit;
  background: linear-gradient(150deg, hsl(var(--hue-gray), 15%, var(--lightness-surface-3), 0.9), hsl(var(--hue-gray), 20%, var(--lightness-surface-2), 0.9));
  border: 1px solid var(--border-base);
  box-shadow: var(--shadow-inset);
  transition: background 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
}

.control-btn::after, .action-btn::after, .macro-btn::after, .waypoint-btn::after, .movement-btn::after {
    content: "";
    position: absolute;
    inset: -2px;
    z-index: -1;
    border-radius: inherit;
    background: conic-gradient( from var(--angle), transparent 0%,
        hsla(var(--btn-hue-1), 100%, 75%, 0.7), hsla(var(--btn-hue-2), 100%, 75%, 0.7),
        hsla(var(--btn-hue-1), 100%, 75%, 0.7), transparent 70%);
    filter: blur(6px);
    opacity: 0;
    --angle: 0deg;
    transition: opacity 0.5s ease, filter 0.5s ease;
}
.control-btn > .sparkle, .action-btn > .sparkle, .macro-btn > .sparkle, .waypoint-btn > .sparkle, .movement-btn > .sparkle {
    content: "";
    position: absolute;
    top: 0;
    left: var(--sparkleX, -100%);
    width: 40%;
    height: 100%;
    background: linear-gradient(to right, transparent 0%, hsla(0, 0%, 100%, 0.3) 50%, transparent 100%);
    transform: skewX(-20deg);
    opacity: 0;
    pointer-events: none;
    transition: left 0s linear, opacity 0s linear;
    z-index: 1;
}

.control-btn:hover, .action-btn:hover, .macro-btn:hover, .waypoint-btn:hover, .movement-btn:hover {
  color: var(--text-white);
  transform: translateY(-4px) scale(1.03);
  box-shadow: var(--shadow-lg), var(--glow-lg) var(--btn-glow-color);
}
.control-btn:hover::before, .action-btn:hover::before, .macro-btn:hover::before, .waypoint-btn:hover::before, .movement-btn:hover::before {
  background: linear-gradient(150deg, hsla(var(--hue-gray), 20%, calc(var(--lightness-surface-3) + 5%), 0.95), hsla(var(--hue-gray), 25%, calc(var(--lightness-surface-2) + 5%), 0.95));
  border-color: hsla(var(--btn-hue-1), 80%, 70%, 0.8);
  box-shadow: var(--shadow-inset), 0 2px 5px hsla(0, 0%, 0%, 0.3);
}
.control-btn:hover::after, .action-btn:hover::after, .macro-btn:hover::after, .waypoint-btn:hover::after, .movement-btn:hover::after {
    opacity: 1;
    filter: blur(9px);
    animation: rotateButtonBorder 4s linear infinite;
}
.control-btn:hover > .sparkle, .action-btn:hover > .sparkle, .macro-btn:hover > .sparkle, .waypoint-btn:hover > .sparkle, .movement-btn:hover > .sparkle {
    --sparkleX: 110%;
    opacity: 1;
    transition: left 0.8s var(--timing-ease-out-cubic) 0.05s, opacity 0.1s linear 0.75s;
}

.control-btn:active, .action-btn:active, .macro-btn:active, .waypoint-btn:active, .movement-btn:active {
  transform: translateY(0px) scale(0.98);
  color: hsla(0, 0%, 80%, 1);
  box-shadow: var(--shadow-inset);
  transition-duration: 100ms;
}
.control-btn:active::before, .action-btn:active::before, .macro-btn:active::before, .waypoint-btn:active::before, .movement-btn:active::before {
  background: linear-gradient(150deg, hsl(var(--hue-gray), 18%, var(--lightness-surface-2)), hsl(var(--hue-gray), 22%, var(--lightness-surface-1)));
  border-color: hsla(var(--btn-hue-1), 60%, 50%, 0.6);
  box-shadow: var(--shadow-inset), inset 0 2px 5px hsla(0, 0%, 0%, 0.4);
}
.control-btn:active::after, .action-btn:active::after, .macro-btn:active::after, .waypoint-btn:active::after, .movement-btn:active::after {
  opacity: 0.5;
  filter: blur(4px);
  animation-play-state: paused;
}

.control-btn:focus-visible, .action-btn:focus-visible, .macro-btn:focus-visible, .waypoint-btn:focus-visible, .movement-btn:focus-visible {
  outline: none;
  color: var(--text-white);
  box-shadow: var(--shadow-focus-ring), var(--shadow-lg), var(--glow-lg) var(--btn-glow-color);
}
.control-btn:focus-visible::before, .action-btn:focus-visible::before, .macro-btn:focus-visible::before, .waypoint-btn:focus-visible::before, .movement-btn:focus-visible::before {
  border-color: var(--secondary-light);
}
.control-btn:focus-visible::after, .action-btn:focus-visible::after, .macro-btn:focus-visible::after, .waypoint-btn:focus-visible::after, .movement-btn:focus-visible::after {
  opacity: 1;
  filter: blur(9px);
  animation: rotateButtonBorder 4s linear infinite;
}

.control-btn i, .action-btn i, .macro-btn i, .waypoint-btn i, .movement-btn i {
  font-size: 1.3em;
  line-height: 1;
  position: relative;
  z-index: 2;
  transition: transform 0.5s var(--timing-elastic-out), color 0.4s ease, filter 0.4s ease;
  color: var(--btn-icon-color);
  filter: drop-shadow(0 1px 2px hsla(0, 0%, 0%, 0.5));
}
.control-btn:hover i, .action-btn:hover i, .macro-btn:hover i, .waypoint-btn:hover i, .movement-btn:hover i {
  transform: scale(1.25) rotate(-10deg);
  color: var(--btn-icon-color-hover);
  filter: drop-shadow(0 0 10px var(--btn-icon-color-hover));
}

.movement-controls {
  display: grid;
  padding: var(--space-sm) 0;
  grid-template-areas:
    ". forward ."
    "left back right"
    "sneak jump jump";
  justify-content: center;
  align-items: center;
  gap: var(--space-md);
}
#move-forward { grid-area: forward; }
#move-left { grid-area: left; }
#move-back { grid-area: back; }
#move-right { grid-area: right; }
#sneak-btn { grid-area: sneak; }
#jump-btn { grid-area: jump; justify-self: stretch; }

.movement-btn {
  --btn-hue-1: var(--hue-primary);
  --btn-hue-2: var(--hue-tertiary);
  --btn-glow-color: var(--primary-glow-color);
  --btn-icon-color: var(--primary-main);
  --btn-icon-color-hover: var(--primary-light);
  width: clamp(65px, 7vw, 85px);
  height: clamp(65px, 7vw, 85px);
  border-radius: var(--radius-md);
  font-size: clamp(1.8rem, 2.2vw, 2.4rem);
}
.movement-btn:hover {
  box-shadow: var(--shadow-lg), var(--glow-xl) var(--btn-glow-color);
}

.action-controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: var(--space-md);
}
#attack-btn {
  --btn-hue-1: var(--hue-danger);
  --btn-hue-2: var(--hue-quaternary);
  --btn-icon-color: var(--danger-main);
  --btn-icon-color-hover: var(--danger-light);
  --btn-glow-color: var(--danger-glow-color);
}
#mine-btn {
  --btn-hue-1: var(--hue-primary);
  --btn-hue-2: var(--hue-tertiary);
  --btn-icon-color: var(--primary-main);
  --btn-icon-color-hover: var(--primary-light);
  --btn-glow-color: var(--primary-glow-color);
}
#place-btn {
  --btn-hue-1: var(--hue-success);
  --btn-hue-2: var(--hue-tertiary);
  --btn-icon-color: var(--success-main);
  --btn-icon-color-hover: var(--success-light);
  --btn-glow-color: var(--success-glow-color);
}
#stop-btn {
  --btn-hue-1: var(--hue-danger);
  --btn-hue-2: var(--hue-danger);
  --btn-icon-color: white;
  --btn-icon-color-hover: white;
  --btn-glow-color: var(--danger-glow-color);
  grid-column: 1 / -1;
  color: white !important;
}
#stop-btn::before {
  background: linear-gradient(150deg, var(--danger-main), var(--danger-dark));
  border-color: var(--danger-dark);
}
#stop-btn:hover::before {
  background: linear-gradient(150deg, var(--danger-light), var(--danger-main));
  border-color: var(--danger-main);
}
#stop-btn:active::before {
  background: linear-gradient(150deg, var(--danger-dark), hsl(var(--hue-danger), 100%, 35%));
  border-color: var(--danger-dark);
}
#stop-btn::after {
  background: conic-gradient(from var(--angle), transparent 0%, hsla(var(--hue-danger),100%,75%,0.8) 30%, hsla(var(--hue-danger),100%,75%,0.8) 50%, transparent 80%);
}

.macro-controls {
  grid-column: 1 / -1;
}
.macro-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(clamp(160px, 16vw, 200px), 1fr));
  gap: var(--space-md);
  justify-content: space-between;
}
.macro-btn {
  --btn-hue-1: var(--hue-tertiary);
  --btn-hue-2: var(--hue-senary);
  --btn-glow-color: var(--tertiary-glow-color);
  --btn-icon-color: var(--tertiary-main);
  --btn-icon-color-hover: var(--tertiary-light);
  justify-content: flex-start;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  text-transform: none;
  letter-spacing: 0.3px;
  padding: var(--space-sm) var(--space-sm);
}
.macro-btn i {
  width: 25px;
  text-align: center;
  flex-shrink: 0;
}

.waypoint-controls {
  grid-column: 1 / -1;
}
.waypoint-form {
  display: grid;
  gap: var(--space-md);
}
#waypoint-name {
  padding: var(--space-sm) var(--space-md);
  background: var(--bg-surface-1);
  border: 1px solid var(--border-base);
  color: var(--text-primary);
  border-radius: var(--radius);
  font-size: var(--font-size-sm);
  transition: var(--transition);
  box-shadow: var(--shadow-inset);
  min-width: 180px;
  font-family: var(--font-mono);
}
#waypoint-name::placeholder {
  color: var(--text-tertiary);
  opacity: 0.6;
}
#waypoint-name:focus, #waypoint-name:focus-visible {
  outline: none;
  border-color: var(--border-focus);
  background: var(--bg-surface-2);
  box-shadow: var(--shadow-focus-ring), var(--shadow-inset), var(--shadow-glow-secondary);
}
.waypoint-btn {
    --btn-hue-1: var(--hue-info);
    --btn-hue-2: var(--hue-tertiary);
    --btn-icon-color: var(--info-main);
    --btn-icon-color-hover: var(--info-light);
    --btn-glow-color: var(--primary-glow-color);
}
@media (min-width: 700px) {
  .waypoint-form {
    grid-template-columns: 1fr auto auto auto;
    grid-template-areas: "name save goto list";
    align-items: center;
  }
  #waypoint-name { grid-area: name; margin-bottom: 0; }
  #save-waypoint { grid-area: save; }
  #goto-waypoint { grid-area: goto; }
  #list-waypoints { grid-area: list; }
}

#mini-map {
  /* --- THAY ĐỔI --- */
  position: relative; /* Đổi từ fixed sang relative hoặc static */
  /* XÓA BỎ: bottom: var(--space-lg); */
  /* XÓA BỎ: right: var(--space-lg); */
  /* XÓA BỎ: z-index: 20; */
  /* XÓA BỎ: animation: miniMapFloatPulse 7s ease-in-out infinite alternate; */ /* Bỏ hiệu ứng float */
  margin: var(--space-md) auto; /* Tự căn giữa ngang nếu nó chiếm hết cột grid, hoặc xóa nếu muốn tự căn theo grid */
  justify-self: center; /* Căn giữa theo chiều ngang trong ô grid của nó */
  align-self: center;   /* Căn giữa theo chiều dọc trong ô grid của nó */

  /* --- GIỮ NGUYÊN --- */
  width: clamp(180px, 14vw, 200px); /* Có thể giảm max width nếu cần */
  height: clamp(180px, 14vw, 200px);
  background: var(--glass-bg);
  backdrop-filter: var(--glass-blur) var(--glass-saturation) var(--glass-brightness);
  border: 1px solid var(--glass-border-color);
  border-radius: var(--radius-full);
  overflow: hidden;
  box-shadow: var(--shadow-xl), 0 0 0 5px hsla(var(--hue-tertiary), 60%, 40%, 0.85);
  transition: all 0.5s var(--timing-ease-out-cubic); /* Giảm thời gian transition */
  transform-origin: center center;
  transform: scale(1);
  opacity: 0.95; /* Tăng nhẹ opacity */
}
#mini-map:hover {
  transform: scale(1.25) translateY(-12px) rotate(10deg);
  opacity: 1;
  box-shadow: var(--shadow-xl), 0 0 0 7px var(--tertiary-light), var(--glow-xl) var(--tertiary-glow-color);
  animation-play-state: paused;
}
#mini-map::after {
  content: '';
  position: absolute;
  top: -50%; left: -50%;
  width: 200%; height: 200%;
  background: conic-gradient( from var(--angle), transparent 0deg, transparent 200deg,
      hsla(var(--hue-tertiary), 95%, 75%, 0.55) 260deg,
      hsla(var(--hue-tertiary), 90%, 70%, 0.25) 300deg,
      transparent 360deg );
  animation: quantumScannerSweep 3.5s linear infinite;
  z-index: 2;
  pointer-events: none;
  border-radius: 50%;
  filter: blur(1.5px);
}
#map-canvas {
  width: 100%;
  height: 100%;
  display: block;
  position: relative;
  z-index: 1;
  background: radial-gradient(circle, hsla(var(--hue-gray), 30%, 20%, 0.92) 0%, hsla(var(--hue-gray), 40%, 8%, 0.98) 80%);
  filter: blur(1px) contrast(1.3) brightness(0.95);
}
#player-marker {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  z-index: 3;
  transform: translate(-50%, -50%) scale(1);
  background: var(--danger-light);
  border: 2px solid var(--text-white);
  box-shadow: 0 0 0 5px hsla(var(--hue-danger), 100%, 80%, 0.85), var(--glow-lg) var(--danger-glow-color);
  transition: transform 0.3s ease-out;
  animation: playerMarkerQuantumPulse 1.6s infinite ease-in-out;
}

.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

@keyframes moveAuroraHyper {
  0% { background-position: 0% 50%; filter: blur(var(--aurora-blur)) brightness(1.15) saturate(1.5) hue-rotate(0deg); }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; filter: blur(var(--aurora-blur)) brightness(1.15) saturate(1.5) hue-rotate(360deg); }
}
@keyframes subtleNebulaWarp {
  0% { transform: scale(1) rotate(0deg); opacity: 0.65; }
  50% { transform: scale(1.05) rotate(5deg); opacity: 0.85; }
  100% { transform: scale(1) rotate(0deg); opacity: 0.65; }
}
@keyframes noiseFlicker {
  0% { opacity: calc(var(--noise-opacity) * 0.9); }
  100% { opacity: calc(var(--noise-opacity) * 1.1); }
}
@keyframes moveGridSteady {
  0% { background-position: 0 0; }
  100% { background-position: var(--grid-size) var(--grid-size); }
}
@keyframes moveScanlines {
  0% { transform: translateY(0px); }
  100% { transform: translateY(4px); }
}
@keyframes scrollbarHueShift {
  0% { filter: hue-rotate(0deg); }
  100% { filter: hue-rotate(360deg); }
}
@keyframes sidebarEntrance {
  to { transform: translateX(0%) scale(1); opacity: 1; }
}
@keyframes sidebarBorderSpin {
    0% { --angle: 0deg; --hueRotate: 0deg; --glowOpacity: 0.6; }
    100% { --angle: 360deg; --hueRotate: 360deg; --glowOpacity: 0.9;}
}
@keyframes iconPulseAndFloat {
  0%, 100% { transform: translateY(0) scale(1) rotate(0deg); }
  25% { transform: translateY(-7px) scale(1.1) rotate(6deg); }
  50% { transform: translateY(-3px) scale(1.05) rotate(0deg); filter: drop-shadow(0 0 20px var(--secondary-light)) drop-shadow(0 0 8px var(--tertiary-light)); }
  75% { transform: translateY(-7px) scale(1.1) rotate(-6deg); }
}
@keyframes statusDotPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.08); }
}
@keyframes statusRingExpand {
  0% { transform: scale(0.8); opacity: 0.8; }
  70% { opacity: 0.1; }
  100% { transform: scale(1.9); opacity: 0; }
}
@keyframes sectionEntrance {
  to { opacity: 1; transform: perspective(1000px) rotateX(0deg) translateY(0px) scale(1); }
}
@keyframes energyLineFlow {
  0% { background-position: 0% 0%; }
  100% { background-position: 0% 200%; }
}
@keyframes dataGridPulse {
  0% { background-size: 35px 35px; opacity: 0.3; }
  50% { background-size: 32px 32px; opacity: 0.5; }
  100% { background-size: 35px 35px; opacity: 0.3; }
}
@keyframes underlineShine {
  0% { background-position: 200% 0; filter: brightness(1.1) blur(1px); }
  50% { background-position: -100% 0; filter: brightness(1.6) blur(0px); }
  100% { background-position: 200% 0; filter: brightness(1.1) blur(1px); }
}
@keyframes invGridPulse {
  0% { background-size: 100% 100%, 8px 8px, 8px 8px; opacity: 0.65; }
  50% { background-size: 100% 100%, 7px 7px, 7px 7px; opacity: 0.85; }
  100% { background-size: 100% 100%, 8px 8px, 8px 8px; opacity: 0.65; }
}
@keyframes messageEntrance {
  from { opacity: 0; transform: translateY(25px) scale(0.9); }
  to { opacity: 1; transform: translateY(0px) scale(1); }
}
@keyframes errorShake {
  10%, 90% { transform: translate3d(-2px, 0, 0) rotate(-0.8deg); }
  20%, 80% { transform: translate3d(4px, 0, 0) rotate(0.8deg); }
  30%, 50%, 70% { transform: translate3d(-5px, 0, 0) rotate(-1.2deg); }
  40%, 60% { transform: translate3d(5px, 0, 0) rotate(1.2deg); }
}
@keyframes errorPulseBorder {
  0%, 100% { border-left-color: var(--error-message-text); box-shadow: 0 4px 10px hsla(0,0%,0%,.45), 0 0 15px var(--danger-glow-color); }
  50% { border-left-color: var(--danger-light); box-shadow: 0 4px 10px hsla(0,0%,0%,.45), 0 0 28px var(--danger-glow-color); }
}
@keyframes rippleExplode {
  0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(12); opacity: 0; }
}
@keyframes viewerSpinner {
  0% { transform: rotate(0deg) scale(1); }
  50% { transform: rotate(180deg) scale(1.05); }
  100% { transform: rotate(360deg) scale(1); }
}
@keyframes viewerGlowPulse {
  0%, 100% { filter: drop-shadow(0 0 25px var(--primary-glow-color)); }
  50% { filter: drop-shadow(0 0 40px var(--primary-glow-color)); }
}
@keyframes techUnderlineFlow {
  0% { background-position: 0% 50%; filter: hue-rotate(0deg) blur(1px); }
  50% { background-position: 200% 50%; }
  100% { background-position: 400% 50%; filter: hue-rotate(360deg) blur(1px); }
}
@keyframes rotateButtonBorder {
  0% { --angle: 0deg; filter: blur(6px) hue-rotate(0deg); }
  100% { --angle: 360deg; filter: blur(9px) hue-rotate(360deg); }
}
@keyframes quantumScannerSweep {
  0% { transform: rotate(0deg); filter: blur(1.5px) hue-rotate(0deg); }
  100% { transform: rotate(360deg); filter: blur(1.5px) hue-rotate(360deg); }
}
@keyframes miniMapFloatPulse {
  0% { transform: translateY(0) rotate(0deg) scale(1); filter: hue-rotate(0deg) brightness(1); }
  50% { transform: translateY(-15px) rotate(-6deg) scale(1.05); filter: hue-rotate(45deg) brightness(1.15); }
  100% { transform: translateY(0) rotate(0deg) scale(1); filter: hue-rotate(0deg) brightness(1); }
}
@keyframes playerMarkerQuantumPulse {
  0%, 100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 5px hsla(var(--hue-danger),100%,80%,.85), var(--glow-lg) var(--danger-glow-color); background: var(--danger-light); }
  50% { transform: translate(-50%, -50%) scale(1.25); box-shadow: 0 0 0 7px hsla(var(--hue-danger),100%,85%,.6), var(--glow-xl) var(--danger-glow-color); background: var(--text-white); }
}

@media (max-width: 1300px) {
   #main-content { padding: var(--space-lg) var(--space-xl); }
   .control-panel { gap: var(--space-lg); padding: var(--space-lg); }
}
@media (max-width: 1024px) {
  #app-container { flex-direction: column; }
  #sidebar { width: 100%; max-height: 50vh; min-height: 280px; overflow-y: auto; animation: none; transform: translateX(0) scale(1); opacity: 1; border-radius: 0 0 var(--radius-xl) var(--radius-xl); order: 1; box-shadow: var(--glass-shadow); }
  #sidebar::before { border-radius: 0 0 var(--radius-xl) var(--radius-xl); inset: auto -3px -3px -3px; }
  #main-content { padding: var(--space-lg); order: 0; }
  #viewer-container { min-height: 55vh; }
  .control-panel { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 768px) {
  :root { --radius-lg: 20px; --radius-xl: 30px; --font-size-base: 1.0rem;}
  #main-content { padding: var(--space-md); }
  #sidebar { gap: var(--space-md); padding: var(--space-md) var(--space-sm); max-height: 45vh;}
  .control-panel { grid-template-columns: 1fr; }
  #mini-map { display: none; }
  .control-panel > div { padding: var(--space-lg); }
  section { padding: var(--space-lg); }
  .inventory-grid { grid-template-columns: repeat(6, 1fr); gap: 8px; }
  .movement-btn { width: 65px; height: 65px; font-size: 1.8rem; }
}
@media (max-width: 576px) {
  :root { --radius-md: 15px; --radius-lg: 18px; --radius-xl: 25px; }
  #sidebar { padding: var(--space-md) var(--space-sm); gap: var(--space-md); min-height: 250px; max-height: 40vh;}
  #sidebar h1 { font-size: var(--font-size-lg); letter-spacing: 1px;}
  section h2 { font-size: var(--font-size-md); }
  #main-content { padding: var(--space-sm); }
  .viewer-header { flex-direction: column; align-items: center; gap: var(--space-sm); }
  .viewer-header h2 { font-size: var(--font-size-lg); text-align: center; }
  .viewer-controls { justify-content: center; gap: var(--space-xs); }
  .control-btn, .action-btn, .macro-btn, .waypoint-btn { font-size: var(--font-size-sm); padding: var(--space-sm) var(--space-sm); gap: var(--space-xs); min-height: 40px; }
  .movement-controls { transform: scale(0.9); gap: var(--space-sm); }
  .movement-btn { width: 60px; height: 60px; font-size: 1.6rem; }
  .inventory-grid { grid-template-columns: repeat(5, 1fr); gap: 6px; }
  .item-count { padding: 1px 5px; font-size: calc(var(--font-size-xs) * 0.9); }
  .control-panel { padding: var(--space-md); gap: var(--space-lg); }
  .control-panel > div { padding: var(--space-md); }
  .macro-grid { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); }
  .waypoint-form { grid-template-columns: 1fr; grid-template-areas: "name" "save" "goto" "list"; gap: var(--space-sm);}
  .chat-form button { width: 50px; height: 50px; font-size: 1.4em; }
  .chat-message { padding: var(--space-xs) var(--space-sm); font-size: var(--font-size-xs); }
  .status-label { font-size: var(--font-size-xs); }
  .status-value { font-size: var(--font-size-sm); }
  #position + .status-value {font-size: var(--font-size-xs);}
}